"use strict";(self.webpackChunkdicoding_story_app=self.webpackChunkdicoding_story_app||[]).push([[792],{167:(e,t,a)=>{var n=a(72),i=a.n(n),r=a(825),o=a.n(r),s=a(659),l=a.n(s),d=a(56),c=a.n(d),p=a(540),m=a.n(p),u=a(113),h=a.n(u),g=a(988),b={};b.styleTagTransform=h(),b.setAttributes=c(),b.insert=l().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=m(),i()(g.A,b),g.A&&g.A.locals&&g.A.locals;const y=a.p+"ee540b3b551e89a09e81.jpg",v={render:()=>`\n      <section id="main-content" tabindex="-1" class="login-section" aria-label="Login page">\n        <form id="login-form" class="login-form" novalidate>\n          <div class="login-logo-container">\n            <img src="${y}" alt="App Logo" class="login-logo" />\n          </div>\n\n          <div class="form-group">\n            <label for="email">Email</label>\n            <input\n              type="email"\n              id="email"\n              name="email"\n              placeholder="Email"\n              aria-required="true"\n              aria-describedby="emailHelp"\n              required\n            />\n            <span id="emailHelp" class="visually-hidden">Enter your email address</span>\n          </div>\n\n          <div class="form-group" style="position: relative;">\n            <label for="password">Password</label>\n            <input\n              type="password"\n              id="password"\n              name="password"\n              placeholder="Password"\n              aria-required="true"\n              aria-describedby="passwordHelp"\n              required\n              minlength="6"\n            />\n            <button\n              type="button"\n              id="toggle-password"\n              aria-label="Show password"\n              style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1rem;"\n            >\n              🧿\n            </button>\n            <span id="passwordHelp" class="visually-hidden">Enter your password, minimum 6 characters</span>\n          </div>\n\n          <button type="submit">Login</button>\n          <p>\n            <a href="#/register">Don't have an account? Register</a>\n          </p>\n        </form>\n      </section>\n    `,onLoginSubmit(e){setTimeout((()=>{const t=document.querySelector("#login-form");if(!t)return;const a=t.querySelector("#password"),n=t.querySelector("#toggle-password");n.addEventListener("click",(()=>{"password"===a.type?(a.type="text",n.setAttribute("aria-label","Hide password"),n.textContent="🚫"):(a.type="password",n.setAttribute("aria-label","Show password"),n.textContent="🧿")})),t.addEventListener("submit",(n=>{n.preventDefault();const i=t.querySelector("#email");if(!i.checkValidity())return void i.focus();if(!a.checkValidity())return void a.focus();const r=i.value.trim(),o=a.value.trim();e(r,o)}))}),0)}},w={render:()=>'\n      <section id="main-content" class="register-area" tabindex="-1" aria-label="Registration Section">\n        <form id="register-form" class="form-container" novalidate>\n          <div class="form-field">\n            <label for="name">Full Name</label>\n            <input type="text" id="name" name="name" required aria-required="true" aria-describedby="name-desc" placeholder="Enter your name" />\n            <span id="name-desc" class="sr-only">Type your full name</span>\n          </div>\n\n          <div class="form-field">\n            <label for="email">Email Address</label>\n            <input type="email" id="email" name="email" required aria-required="true" aria-describedby="email-desc" placeholder="Enter your email" />\n            <span id="email-desc" class="sr-only">Provide a valid email</span>\n          </div>\n\n          <div class="form-field" style="position: relative;">\n            <label for="password">Create Password</label>\n            <input type="password" id="password" name="password" required minlength="6" aria-required="true" aria-describedby="pass-desc" placeholder="Enter password" />\n            <button type="button" id="show-password" aria-label="Show password" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">👁️</button>\n            <span id="pass-desc" class="sr-only">Minimum 6 characters</span>\n          </div>\n\n          <button type="submit">Sign Up</button>\n          <p>\n            <a href="#/login">Have an account? Login here</a>\n          </p>\n        </form>\n      </section>\n    ',onRegisterSubmit(e){setTimeout((()=>{const t=document.querySelector("#register-form");if(!t)return;const a=t.querySelector("#name"),n=t.querySelector("#email"),i=t.querySelector("#password"),r=t.querySelector("#show-password");r?.addEventListener("click",(()=>{const e="password"===i.type;i.type=e?"text":"password",r.setAttribute("aria-label",e?"Hide password":"Show password"),r.textContent=e?"🙈":"👁️"})),t.addEventListener("submit",(t=>{if(t.preventDefault(),!a.checkValidity())return a.focus();if(!n.checkValidity())return n.focus();if(!i.checkValidity())return i.focus();const r=a.value.trim(),o=n.value.trim(),s=i.value.trim();e(r,o,s)}))}),0)}};var f=a(481),S=a.n(f);const k={_map:null,render:()=>'\n      <section id="main-content" tabindex="-1" class="story-feed" style="padding: 1rem;">\n        <h2 tabindex="0" style="margin-bottom: 1rem;">Daftar Cerita</h2>\n\n        <h3>Belum Disimpan</h3>\n        <div id="unsaved-story-list" class="story-list" role="list" aria-label="Cerita belum disimpan"></div>\n\n        <h3 style="margin-top: 2rem;">Cerita Tersimpan</h3>\n        <div id="saved-story-list" class="story-list" role="list" aria-label="Cerita tersimpan"></div>\n\n        <button id="clear-storage" style="margin-top: 2rem;" aria-label="Hapus cerita yang tersimpan lokal">\n          🗑️ Hapus Semua Cerita Lokal\n        </button>\n\n        <div id="map" style="height: 400px; margin-top: 20px;" aria-label="Peta lokasi cerita"></div>\n      </section>\n    ',async showStories(e,t=[]){const a=document.getElementById("saved-story-list"),n=document.getElementById("unsaved-story-list");a.innerHTML="",n.innerHTML="";try{const i=document.getElementById("map");this._map&&(this._map.remove(),this._map=null),i&&(this._map=S().map(i).setView([-6.2,106.816666],5),S().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(this._map));const r=[];e.forEach((e=>{const i=document.createElement("article");i.classList.add("story-item","fade-in"),i.setAttribute("role","listitem"),i.setAttribute("tabindex","0");const o=t.includes(String(e.id));if(i.innerHTML=`\n          <header style="display: flex; align-items: center; gap: 8px;">\n            <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(e.name)}" alt="Avatar ${e.name}" width="40" height="40" style="border-radius: 50%;" />\n            <span style="font-weight: bold;">${e.name}</span>\n          </header>\n\n          <div style="margin-top: 8px;">\n            <img src="${e.photoUrl}" alt="Foto cerita oleh ${e.name}" style="width: 100%; border-radius: 8px;" loading="lazy" />\n          </div>\n\n          <p style="margin-top: 8px;">${e.description||"Tidak ada deskripsi."}</p>\n\n          <p style="font-size: 0.9rem; color: #555;">\n            <strong>Tanggal:</strong> ${e.createdAt?new Date(e.createdAt).toLocaleString("id-ID"):"Tidak tersedia"}\n          </p>\n\n          <p style="font-size: 0.9rem; color: #555;">\n            <strong>Koordinat:</strong> ${"number"==typeof e.lat&&"number"==typeof e.lon?`${e.lat.toFixed(5)}, ${e.lon.toFixed(5)}`:"Tidak tersedia"}\n          </p>\n\n          <div class="button-group" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;">\n            <button class="detail-button" data-id="${e.id}">🔍 Lihat Detail</button>\n            <button class="download-button" data-url="${e.photoUrl}">📥 Download</button>\n            <button class="save-button ${o?"saved":""}" data-id="${e.id}">\n              💾 ${o?"Tersimpan":"Simpan"}\n            </button>\n            <button class="delete-button" data-id="${e.id}">🗑️ Hapus</button>\n          </div>\n        `,o?a.appendChild(i):n.appendChild(i),this._map&&"number"==typeof e.lat&&"number"==typeof e.lon){const t=S().marker([e.lat,e.lon]).addTo(this._map);t.bindPopup(`<strong>${e.name}</strong><br/>${e.description||""}`).openPopup(),setTimeout((()=>t.closePopup()),1500),r.push([e.lat,e.lon])}})),this._map&&r.length>0&&this._map.fitBounds(S().latLngBounds(r))}catch(e){console.error("Gagal memuat peta:",e)}},bindEvents(){this.onDetailClick(this._detailCallback),this.onDownloadClick(),this.onSaveClick(this._saveCallback),this.onDeleteClick(this._deleteCallback),this.onClearStorageClick(this._clearStorageCallback)},onDetailClick(e){this._detailCallback=e,document.querySelectorAll(".detail-button").forEach((t=>{t.addEventListener("click",(()=>e(t.dataset.id)))}))},onDownloadClick(){document.querySelectorAll(".download-button").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.dataset.url,a=t.split("/").pop().split("?")[0]||"gambar.jpg",n=await fetch(t),i=await n.blob(),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}))}))},onSaveClick(e){this._saveCallback=e,document.querySelectorAll(".save-button").forEach((t=>{t.addEventListener("click",(()=>e(t.dataset.id)))}))},onDeleteClick(e){this._deleteCallback=e,document.querySelectorAll(".delete-button").forEach((t=>{t.addEventListener("click",(()=>e(t.dataset.id)))}))},onClearStorageClick(e){this._clearStorageCallback=e;const t=document.getElementById("clear-storage");t&&t.addEventListener("click",(()=>e()))},setSavedStatus(e,t){const a=document.querySelector(`.save-button[data-id="${e}"]`);a&&(a.classList.toggle("saved",t),a.textContent=t?"💾 Tersimpan":"💾 Simpan Cerita")}};var x=a(465),E=a.n(x);const C={presenter:null,render:()=>'\n      <section class="add-story" aria-labelledby="form-title">\n        <h2 id="form-title">Add New Story</h2>\n        <form id="add-story-form" enctype="multipart/form-data" aria-describedby="form-description">\n          <p id="form-description" style="display:none;">Use this form to submit a new story with image and location.</p>\n\n          <div class="form-group">\n            <label for="description">Description <span aria-hidden="true">*</span></label>\n            <textarea id="description" name="description" required placeholder="Tell your story..." aria-label="Story description"></textarea>\n          </div>\n\n          <div class="form-group">\n            <label for="upload-file">Upload Image from Gallery</label>\n            <input type="file" id="upload-file" name="upload-file" accept="image/*" aria-describedby="upload-help" />\n            <small id="upload-help">Choose an image from your device.</small>\n            <img id="image-preview" style="display:none; margin-top:10px; max-width:100%; border-radius:10px;" alt="Image preview of your story" />\n          </div>\n\n          <div class="form-group">\n            <label for="camera-stream">Capture Image from Camera</label>\n            <video id="camera-stream" autoplay playsinline class="responsive-media" aria-label="Live camera preview"></video>\n            <button type="button" id="capture-btn" class="capture-button" style="margin-top:10px;" aria-label="Capture image from camera">📸 Capture</button>\n            <canvas id="snapshot" class="responsive-media" style="display:none;" aria-hidden="true"></canvas>\n          </div>\n\n          <div class="form-group">\n            <label for="map-picker">Choose Location</label>\n            <div id="map-picker" style="height: 300px; border-radius: 10px; overflow: hidden;" role="region" aria-label="Map location picker" tabindex="0"></div>\n            <p id="location-coordinates" style="text-align:center; font-size: 0.9rem; color: #555;">Coordinates will appear here after picking a location.</p>\n          </div>\n\n          <button type="submit" class="submit-button" aria-label="Submit your story with image and location">🚀 Submit Story</button>\n        </form>\n      </section>\n    ',bindPresenter(e){this.presenter=e,window.addEventListener("hashchange",(()=>e.handleRouteChange()));const t=document.getElementById("add-story-form"),a=document.getElementById("description"),n=document.getElementById("camera-stream"),i=document.getElementById("snapshot"),r=document.getElementById("image-preview"),o=document.getElementById("upload-file"),s=document.getElementById("capture-btn"),l=document.getElementById("location-coordinates");e.startCamera(n),e.initMap("map-picker",l),t.addEventListener("submit",(t=>e.handleSubmit(t,a))),s.addEventListener("click",(()=>e.captureImage(n,i,r))),o.addEventListener("change",(t=>e.handleFileUpload(t.target.files[0],r,i)))}},I={_map:null,render:()=>'\n      <section id="detail" class="detail-page" style="display: flex; flex-direction: column; align-items: center; margin-top: 2rem;">\n        <div class="detail-container" style="max-width: 500px; width: 100%; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow: hidden;" aria-label="Detail cerita">\n          <div class="detail-image-container">\n            <img id="detail-image" alt="Foto cerita" class="detail-image" style="width: 100%; height: auto;" />\n            <div style="text-align: right; padding: 0.5rem;">\n              <button id="download-button" aria-label="Unduh gambar cerita" style="background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">\n                📥 Unduh Gambar\n              </button>\n            </div>\n          </div>\n          <div class="detail-info" style="padding: 1rem;">\n            <h2 id="detail-name" style="margin-bottom: 0.5rem;" aria-label="Nama pengguna"></h2>\n            <p id="detail-description" style="margin-bottom: 1rem;" aria-label="Deskripsi cerita"></p>\n            <p style="font-size: 0.9rem; color: #555;" aria-label="Tanggal dibuat">\n              <strong>Dibuat pada:</strong> <span id="detail-createdAt"></span>\n            </p>\n            <p style="font-size: 0.9rem; color: #555;" aria-label="Lokasi cerita">\n              <strong>Lokasi:</strong> <span id="detail-location"></span>\n            </p>\n          </div>\n        </div>\n        <div id="map" style="width: 100%; height: 400px; margin-top: 2rem; max-width: 500px;" aria-label="Peta lokasi cerita"></div>\n      </section>\n    ',showDetail(e){const t=document.getElementById("detail-image");t.src=e.photoUrl||"default.jpg",t.alt=`Foto cerita dari ${e.name||"Pengguna"}`,document.getElementById("detail-name").textContent=e.name||"Tidak ada nama",document.getElementById("detail-description").textContent=e.description||"Tidak ada deskripsi",document.getElementById("detail-createdAt").textContent=new Date(e.createdAt).toLocaleString("id-ID"),void 0!==e.lat&&void 0!==e.lon?(document.getElementById("detail-location").textContent=`${e.lat}, ${e.lon}`,this.showMap(e.lat,e.lon)):document.getElementById("detail-location").textContent="Tidak diketahui",this.setupDownloadButton(e.photoUrl)},setupDownloadButton(e){const t=document.getElementById("download-button");t&&e&&t.addEventListener("click",(async()=>{try{const t=await fetch(e),a=await t.blob(),n=URL.createObjectURL(a),i=document.createElement("a"),r=e.split("/").pop().split("?")[0]||"gambar.jpg";i.href=n,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}catch(e){console.error("Gagal mengunduh gambar:",e),alert("Gagal mengunduh gambar.")}}))},showMap(e,t){this._map&&(this._map.remove(),this._map=null),this._map=S().map("map").setView([e,t],13);const a=S().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}),n=S().tileLayer("https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=2sxrVeV47fFEDxOxOeGS",{attribution:"&copy; MapTiler & OpenStreetMap contributors"}),i=S().tileLayer("https://api.maptiler.com/maps/darkmatter/{z}/{x}/{y}.png?key=2sxrVeV47fFEDxOxOeGS",{attribution:"&copy; MapTiler & OpenStreetMap contributors"});a.addTo(this._map),S().marker([e,t]).addTo(this._map).bindPopup("Lokasi cerita").openPopup(),S().control.layers({Streets:a,Satellite:n,"Dark Mode":i}).addTo(this._map)}},A=class{constructor(){this.footerElement=document.createElement("footer"),this.footerElement.classList.add("footer"),this.footerElement.setAttribute("id","footer-content"),this.footerElement.setAttribute("tabindex","-1")}render(){return this.footerElement.innerHTML='\n      <div class="footer-container">\n    <p class="footer-credit">© 2025 ShineStory<p>\n  </div>\n',this.footerElement}},D=class{constructor(e=""){this.logoText=e,this.navbarElement=document.createElement("header"),this.navbarElement.classList.add("navbar")}render(){const e=!!localStorage.getItem("token");if(localStorage.getItem("userName"),localStorage.getItem("userEmail"),this.navbarElement.innerHTML=`\n      <div class="navbar-inner">\n        <div class="navbar-logo">\n          <img src="${y}" alt="Logo" class="navbar-logo-img" />\n          <span class="navbar-logo-text">${this.logoText}</span>\n        </div>\n\n        <nav class="navbar-menu">\n          <a href="#/stories" class="navbar-button">🏠 Home</a>\n          <a href="#/add" class="navbar-button">➕ Add Story</a>\n          ${e?'<button id="logout-btn" class="navbar-button">🚪 Logout</button>':'<a href="#/login" class="navbar-button">🔐 Login</a>'}\n        </nav>\n      </div>\n    `,e){const e=this.navbarElement.querySelector("#logout-btn");e&&e.addEventListener("click",(()=>{localStorage.removeItem("token"),localStorage.removeItem("userName"),localStorage.removeItem("userEmail"),window.location.hash="/login"}))}return this._highlightActiveLink(),this.navbarElement}_highlightActiveLink(){const e=this.navbarElement.querySelectorAll(".navbar-button[href]"),t=window.location.hash;e.forEach((e=>{e.getAttribute("href")===t?e.classList.add("active"):e.classList.remove("active")}))}},T=()=>'\n      <div class="not-found">\n        <h2>404 - Halaman Tidak Ditemukan</h2>\n        <p>Halaman yang kamu tuju tidak tersedia.</p>\n        <a href="#/login" class="back-home">Kembali ke Beranda</a>\n      </div>\n    ',_="https://story-api.dicoding.dev/v1",$={async login(e,t){const a=await fetch(`${_}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await a.json();if(n.error)throw new Error(n.message);return n.loginResult},async register(e,t,a){const n=await fetch(`${_}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:a})}),i=await n.json();if(i.error)throw new Error(i.message);return i}},B="stories";function q(){return new Promise(((e,t)=>{const a=indexedDB.open("story-db",1);a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(B)||t.createObjectStore(B,{keyPath:"id"})},a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)}))}function P(e){return new Promise(((t,a)=>{e.oncomplete=()=>t(),e.onerror=()=>a(e.error),e.onabort=()=>a(e.error)}))}const M={async saveStory(e){const t=(await q()).transaction(B,"readwrite"),a=t.objectStore(B),n={...e,id:String(e.id)};return a.put(n),P(t)},async getAllStories(){const e=(await q()).transaction(B,"readonly").objectStore(B);return new Promise(((t,a)=>{const n=e.getAll();n.onsuccess=()=>t(n.result),n.onerror=()=>a(n.error)}))},async deleteStory(e){const t=(await q()).transaction(B,"readwrite"),a=t.objectStore(B),n=String(e),i=a.delete(n);return i.onsuccess=()=>console.log(`Cerita dengan ID ${n} berhasil dihapus.`),i.onerror=()=>console.error(`Gagal menghapus cerita dengan ID ${n}`),P(t)},async clearStories(){const e=(await q()).transaction(B,"readwrite");return e.objectStore(B).clear(),P(e)}},R=class{constructor({view:e}){this.view=e,this.token=localStorage.getItem("token"),this.init()}async init(){try{if(!this.token)return E().fire({icon:"warning",title:"Login Required",text:"Please login first."}),void(window.location.hash="#/login");const e=window.location.hash.split("/"),t=e[e.length-1],a=await async function(e,t){const a=await fetch(`${_}/stories/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),n=await a.json();if(n.error)throw new Error(n.message);return n.story}(this.token,t);this.view.showDetail(a)}catch(e){E().fire({icon:"error",title:"Error",text:"Failed to load story detail."})}}},j={"/login":{view:v,presenter:class{constructor({view:e}){this.view=e,this.init()}init(){this.view.onLoginSubmit(this.handleLogin.bind(this))}async handleLogin(e,t){try{const a=await $.login(e,t);localStorage.setItem("token",a.token),E().fire({icon:"success",title:"Login Successful",text:"You are now logged in!"}),window.location.hash="#/stories"}catch(e){E().fire({icon:"error",title:"Login Failed",text:e.message||"Invalid credentials."})}}}},"/register":{view:w,presenter:class{constructor({view:e}){this.view=e,this.init()}init(){this.view.onRegisterSubmit(this.handleRegister.bind(this))}async handleRegister(e,t,a){try{await $.register(e,t,a),E().fire({icon:"success",title:"Registration Successful",text:"You can now log in!"}),window.location.hash="#/login"}catch(e){E().fire({icon:"error",title:"Registration Failed",text:e.message||"Something went wrong."})}}}},"/stories":{view:k,presenter:class{constructor({view:e}){this.view=e,this.token=localStorage.getItem("token"),this.stories=[],this.savedIds=[],this.init()}async init(){try{if(!this.token)return E().fire("Login Required","Please login first.","warning"),void(window.location.hash="#/login");const e=await async function(e){const t=await fetch(`${_}/stories`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),a=await t.json();if(a.error)throw new Error(a.message);return a.listStory}(this.token);this.stories=e;const t=await M.getAllStories();this.savedIds=t.map((e=>String(e.id))),this.view.render(),await this.refreshStories()}catch(e){const t=await M.getAllStories();this.stories=t,this.savedIds=t.map((e=>String(e.id))),this.view.render(),t.length>0?(await this.refreshStories(),E().fire("Offline Mode","Showing data from local storage.","info")):E().fire("Failed to Load Stories","No data available.","error")}this.view.onClearStorageClick(this.handleClearStorage.bind(this))}async refreshStories(){const e=await M.getAllStories();this.savedIds=e.map((e=>String(e.id)));const t=new Set(this.savedIds),a=this.stories.filter((e=>t.has(String(e.id)))),n=[...this.stories.filter((e=>!t.has(String(e.id)))),...a];await this.view.showStories(n,this.savedIds),this.view.onDetailClick(this.handleDetailClick.bind(this)),this.view.onDownloadClick(),this.view.onSaveClick(this.handleSaveStory.bind(this)),this.view.onDeleteClick(this.handleDeleteStory.bind(this))}handleDetailClick(e){window.location.hash=`#/stories/${e}`}async handleSaveStory(e){try{const t=this.stories.find((t=>String(t.id)===String(e)));if(!t)return void E().fire("Failed","Story not found.","error");await M.saveStory(t),await this.refreshStories(),E().fire("Success","Story saved to local storage.","success")}catch(e){console.error("Failed to save story:",e),E().fire("Error","Failed to save story.","error")}}async handleDeleteStory(e){try{const t=String(e);console.log("Deleting story with ID:",t),await M.deleteStory(t),this.savedIds=this.savedIds.filter((e=>e!==t)),await this.refreshStories(),E().fire("Deleted","Story removed from local storage.","success")}catch(e){console.error("Failed to delete story:",e),E().fire("Error","Failed to delete story.","error")}}async handleClearStorage(){try{await M.clearStories(),this.savedIds=[],await this.refreshStories(),E().fire("Success","All local stories have been cleared.","success")}catch(e){console.error("Failed to clear all stories:",e),E().fire("Error","Failed to clear local stories.","error")}}}},"/add":{view:C,presenter:class{constructor({view:e}){this.view=e,this.token=localStorage.getItem("token"),this.stream=null,this.capturedImage=null,this.uploadedImage=null,this.lat=null,this.lon=null,this.handleRouteChange=this.handleRouteChange.bind(this),this.view&&this.view.bindPresenter(this)}async startCamera(e){try{this.stream=await navigator.mediaDevices.getUserMedia({video:!0}),e&&(e.srcObject=this.stream)}catch(e){console.error("Camera error:",e),E().fire({icon:"error",title:"Camera Error",text:"Unable to access camera."})}}stopCamera(){this.stream&&(this.stream.getTracks().forEach((e=>e.stop())),this.stream=null)}handleRouteChange(){this.stopCamera()}captureImage(e,t,a){t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),t.style.display="block",a.style.display="none",t.toBlob((e=>{this.capturedImage=e,this.uploadedImage=null}),"image/jpeg"),this.stopCamera()}handleFileUpload(e,t,a){if(e){this.uploadedImage=e,this.capturedImage=null;const n=new FileReader;n.onload=e=>{t.src=e.target.result,t.style.display="block"},n.readAsDataURL(e),a.style.display="none",this.stopCamera()}}initMap(e,t){const a=L.map(e).setView([-6.2,106.816666],5);let n;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(a),a.on("click",(e=>{this.lat=e.latlng.lat,this.lon=e.latlng.lng,t.textContent=`Lat: ${this.lat.toFixed(5)}, Lng: ${this.lon.toFixed(5)}`,n?n.setLatLng(e.latlng):n=L.marker(e.latlng).addTo(a)}))}async handleSubmit(e,t,a,n,i,r){e.preventDefault();const o=t.value.trim(),s=this.uploadedImage||this.capturedImage;if(o)if(s)try{await async function(e,{description:t,photo:a,lat:n,lon:i}){const r=new FormData;r.append("description",t),r.append("photo",a),void 0!==n&&r.append("lat",n),void 0!==i&&r.append("lon",i);const o=await fetch(`${_}/stories`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r}),s=await o.json();if(s.error)throw new Error(s.message);return s}(this.token,{description:o,photo:s,lat:this.lat,lon:this.lon}),this.stopCamera(),E().fire({title:"Story Added",text:"Story added successfully!",icon:"success",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),"serviceWorker"in navigator&&(await navigator.serviceWorker.ready).showNotification("Story berhasil dibuat",{body:`Anda telah membuat story baru dengan deskripsi: ${o}`,icon:"/icons/icon-192x192.png",vibrate:[100,50,100]}),a&&a(),n&&(n.style.display="none"),i&&(i.style.display="none"),r&&(r.textContent=""),this.lat=null,this.lon=null}catch(e){console.error("Error uploading story:",e),E().fire({icon:"error",title:"Error",text:`Failed to add story: ${e.message}`})}else E().fire({icon:"warning",title:"Image Required",text:"Please capture or upload an image first."});else E().fire({icon:"warning",title:"Description Required",text:"Description is required."})}}}},F=async e=>{const t=document.getElementById("main-content");t&&await t.animate([{opacity:1,transform:"translateY(0px)"},{opacity:0,transform:"translateY(20px)"}],{duration:300,easing:"ease-in",fill:"forwards"}).finished,e();const a=document.getElementById("main-content");a&&a.animate([{opacity:0,transform:"translateY(20px)"},{opacity:1,transform:"translateY(0px)"}],{duration:300,easing:"ease-out",fill:"forwards"})},O=()=>{const e=document.getElementById("app"),t=window.location.hash.slice(1)||"/login";e.innerHTML="";const a="/login"===t||"/register"===t,n=t.match(/^\/stories\/(.+)/);if(n){const t=n[1];if(!a){const t=new D;e.appendChild(t.render())}const i=document.createElement("div");if(i.setAttribute("id","main-content"),i.setAttribute("tabindex","-1"),i.innerHTML=I.render(),e.appendChild(i),new R({view:I,id:t}),!a){const t=new A;e.appendChild(t.render())}return}const i=j[t];if(!i){if(!a){const t=new D;e.appendChild(t.render())}const t=document.createElement("div");if(t.setAttribute("id","main-content"),t.setAttribute("tabindex","-1"),t.innerHTML=T(),e.appendChild(t),!a){const t=new A;e.appendChild(t.render())}return}if(!a){const t=new D;e.appendChild(t.render())}const r=document.createElement("div");if(r.setAttribute("id","main-content"),r.setAttribute("tabindex","-1"),r.innerHTML=i.view.render(),e.appendChild(r),new i.presenter({view:i.view}),!a){const t=new A;e.appendChild(t.render())}},U=()=>{document.startViewTransition?document.startViewTransition((()=>{F(O)})):F(O)};function H(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=atob(t),n=new Uint8Array(a.length);for(let e=0;e<a.length;++e)n[e]=a.charCodeAt(e);return n}window.addEventListener("hashchange",U),window.addEventListener("load",U),document.addEventListener("click",(e=>{if(e.target.classList.contains("skip-link")){e.preventDefault();const t=e.target.getAttribute("href")?.replace("#",""),a=document.getElementById(t);a&&setTimeout((()=>{a.setAttribute("tabindex","-1"),a.focus()}),0)}})),"serviceWorker"in navigator&&"PushManager"in window&&window.addEventListener("load",(async()=>{try{const e=await navigator.serviceWorker.register("/service-worker.js");if(console.log("Service Worker registered:",e),"granted"===await Notification.requestPermission()){const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:H("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk")}),a=localStorage.getItem("token");a&&await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(t)})}}catch(e){console.error("SW registration or push error:",e)}})),document.addEventListener("click",(e=>{if(e.target.classList.contains("skip-link")){e.preventDefault();const t=e.target.getAttribute("href")?.replace("#",""),a=document.getElementById(t);a&&(a.setAttribute("tabindex","-1"),a.focus())}}))},988:(e,t,a)=>{a.d(t,{A:()=>s});var n=a(601),i=a.n(n),r=a(314),o=a.n(r)()(i());o.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const s=o}},e=>{e.O(0,[849],(()=>e(e.s=167))),e.O()}]);